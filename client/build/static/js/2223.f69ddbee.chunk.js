"use strict";(self.webpackChunkemind=self.webpackChunkemind||[]).push([[2223],{68470:function(e,r,s){s(72791);var i=s(80184),t=function(e){var r=e.children,s=e.className,t=e.alignItems,n=e.justifyContent,a=e.mobileFlex,d=e.flexDirection;return(0,i.jsx)("div",{className:"".concat(a?"d-flex":"d-md-flex"," ").concat(s," ").concat(d?"flex-"+d:""," ").concat(t?"align-items-"+t:""," ").concat(n?"justify-content-"+n:""),children:r})};t.defaultProps={mobileFlex:!0,flexDirection:"row",className:""},r.Z=t},2223:function(e,r,s){s.r(r),s.d(r,{default:function(){return A}});var i=s(72791),t=s(29439),n=s(20003),a=s(50419),d=s(87309),l=s(66871),o=s(49389),m=s(59432),u=s(36795),c=s(82464),x=s(11730),j=s(31549),Z=s(68470),f=s(2703),h=s(73332),p=s(22949),v=s(37083),b=s(66106),y=s(30914),g=s(11561),C=s(84376),q=s(96578),I=s(41920),w=s(20077),k=s(82259),T=s(7378),N=s(72426),P=s.n(N),D=s(82630),F=s(48936),S=s(80184);var Y=function(e){var r=e.editData,s=e.formType,n=e.setIsModalVisible,d=e.refetch,l=h.Z.useForm(),m=(0,t.Z)(l,1)[0],u=p.Z.Option,c=o.Z.TextArea,x=(0,C.D)(w.LZ,{onCompleted:function(e){a.ZP.success("\u0410\u043c\u0436\u0438\u043b\u0442\u0442\u0430\u0439 \u0445\u0430\u0434\u0433\u0430\u043b\u043b\u0430\u0430"),m.resetFields(),n(!1),d()}}),j=(0,t.Z)(x,2),Z=j[0],f=j[1].loading,N=(0,C.D)(k.YK,{onCompleted:function(e){a.ZP.success("\u0410\u043c\u0436\u0438\u043b\u0442\u0442\u0430\u0439 \u0445\u0430\u0434\u0433\u0430\u043b\u043b\u0430\u0430"),m.resetFields(),n(!1),d()}}),Y=(0,t.Z)(N,2),M=Y[0],_=Y[1].loading,E=(0,q.a)(I.$_).data,O=(0,q.a)(I.NC).data,V=(0,q.a)(T.l4).data,z=(0,q.a)(I.gw).data,A=(0,q.a)(F.YO).data,$=(0,q.a)(I.MA).data;(0,i.useEffect)((function(){if("edit"===s){var e,i={name:r.name,employeeCode:r.employeeCode,familyName:r.familyName,registerNo:r.registerNo,phone:r.phone,phone2:r.phone2,address:r.address,sex:r.sex,birthCity:r.birthCity.id,birthDistrict:r.birthDistrict.id,status:r.status.id,id:r.id,username:r.user.username,email:r.user.email,compartment:null===(e=r.compartment)||void 0===e?void 0:e.id,birthdate:P()(r.birthdate)};G(i.birthCity),ee(P()(i.birthdate).format("YYYY-MM-DD")),m.setFieldsValue(i)}else"create"===s&&m.resetFields()}),[m,r,s]);var K=(0,i.useState)(""),R=(0,t.Z)(K,2),B=R[0],G=R[1],L=null,U=null;B&&(L=B),L&&(U=null===O||void 0===O?void 0:O.allDistricts.filter((function(e){return e.cityID.id===L})).map((function(e){return(0,S.jsx)(u,{value:e.id,children:e.name},e.id)})));var H=(0,i.useState)(""),J=(0,t.Z)(H,2);J[0],J[1];var Q=(0,i.useState)(""),W=(0,t.Z)(Q,2),X=W[0],ee=W[1],re=new RegExp(/^[7-9][0-9]{3}[0-9]{4}$/),se=new RegExp(/[\u0401\u0410-\u042F\u04AE\u04E8]{2}([0-9]){8}$/);return(0,S.jsx)(v.Z,{spinning:f||_,tip:"\u0410\u0447\u0430\u0430\u043b\u043b\u0430\u0436 \u0431\u0430\u0439\u043d\u0430...",children:(0,S.jsx)(h.Z,{id:"TeacherForm",layout:"vertical",form:m,name:"control-hooks",onFinish:function(e){"edit"===s?(e.id=r.id,e.birthdate=X,M({variables:e})):(e.birthdate=X,Z({variables:e}))},children:(0,S.jsxs)(b.Z,{gutter:[16,24],children:[(0,S.jsxs)(y.Z,{className:"gutter-row",span:12,children:[(0,S.jsx)(h.Z.Item,{name:"familyName",label:(0,S.jsx)(D.Z,{id:"familyName"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})}],children:(0,S.jsx)(o.Z,{})}),(0,S.jsx)(h.Z.Item,{name:"name",label:(0,S.jsx)(D.Z,{id:"name"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})}],children:(0,S.jsx)(o.Z,{})}),(0,S.jsx)(h.Z.Item,{name:"registerNo",label:(0,S.jsx)(D.Z,{id:"registerNo"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})},{validator:function(e,r){return se.test(r)?Promise.resolve():Promise.reject("\u0420\u0435\u0433\u0438\u0441\u0442\u0435\u0440\u0438\u0439\u043d \u0434\u0443\u0433\u0430\u0430\u0440 \u0431\u0443\u0440\u0443\u0443 \u0431\u0430\u0439\u043d\u0430!")}}],children:(0,S.jsx)(o.Z,{})}),(0,S.jsx)(h.Z.Item,{name:"birthdate",label:(0,S.jsx)(D.Z,{id:"birthdate"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})}],children:(0,S.jsx)(g.Z,{style:{width:"100%"},onChange:function(e){ee(P()(e).format("YYYY-MM-DD"))},format:"YYYY-MM-DD"})}),(0,S.jsx)(h.Z.Item,{name:"sex",label:(0,S.jsx)(D.Z,{id:"sex"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})}],children:(0,S.jsxs)(p.Z,{children:[(0,S.jsx)(u,{value:"\u042d\u0440\u044d\u0433\u0442\u044d\u0439",children:(0,S.jsx)(D.Z,{id:"sex.male"})},"0"),(0,S.jsx)(u,{value:"\u042d\u043c\u044d\u0433\u0442\u044d\u0439",children:(0,S.jsx)(D.Z,{id:"sex.female"})},"1")]})}),(0,S.jsx)(h.Z.Item,{name:"birthCity",label:(0,S.jsx)(D.Z,{id:"birthCity"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})}],children:(0,S.jsx)(p.Z,{onChange:function(e){G(e)},children:null===E||void 0===E?void 0:E.allCitys.map((function(e,r){return(0,S.jsx)(u,{value:e.id,children:e.name},r)}))})}),(0,S.jsx)(h.Z.Item,{name:"birthDistrict",label:(0,S.jsx)(D.Z,{id:"birthDistrict"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})}],children:(0,S.jsx)(p.Z,{children:U})}),"create"===s&&(0,S.jsx)(h.Z.Item,{name:"group",label:(0,S.jsx)(D.Z,{id:"group-permission"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})}],children:(0,S.jsx)(p.Z,{children:null===A||void 0===A?void 0:A.allGroups.filter((function(e){return"1"!==e.id&&"2"!==e.id&&"3"!==e.id})).map((function(e,r){return(0,S.jsx)(u,{value:e.id,children:e.name},r)}))})}),(0,S.jsx)(h.Z.Item,{name:"compartment",label:(0,S.jsx)(D.Z,{id:"compartment"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})}],children:(0,S.jsx)(p.Z,{children:null===$||void 0===$?void 0:$.allEmployeesCompartment.map((function(e,r){return(0,S.jsx)(u,{value:e.id,children:e.name},r)}))})})]}),(0,S.jsxs)(y.Z,{className:"gutter-row",span:12,children:[(0,S.jsx)(h.Z.Item,{name:"status",label:(0,S.jsx)(D.Z,{id:"status"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})}],children:(0,S.jsx)(p.Z,{children:null===V||void 0===V?void 0:V.allTeacherStatuss.map((function(e,r){return(0,S.jsx)(u,{value:e.id,children:e.name},r)}))})}),(0,S.jsx)(h.Z.Item,{name:"employeeCode",label:(0,S.jsx)(D.Z,{id:"employeeCode"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})}],children:(0,S.jsx)(o.Z,{})}),(0,S.jsx)(h.Z.Item,{name:"phone",label:(0,S.jsx)(D.Z,{id:"phone"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})},{validator:function(e,r){return re.test(r)?Promise.resolve():Promise.reject("\u0423\u0442\u0430\u0441\u043d\u044b \u0434\u0443\u0433\u0430\u0430\u0440 \u0431\u0443\u0440\u0443\u0443 \u0431\u0430\u0439\u043d\u0430!")}}],children:(0,S.jsx)(o.Z,{})}),(0,S.jsx)(h.Z.Item,{name:"phone2",label:(0,S.jsx)(D.Z,{id:"phone2"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})},{validator:function(e,r){return re.test(r)?Promise.resolve():Promise.reject("\u0423\u0442\u0430\u0441\u043d\u044b \u0434\u0443\u0433\u0430\u0430\u0440 \u0431\u0443\u0440\u0443\u0443 \u0431\u0430\u0439\u043d\u0430!")}}],children:(0,S.jsx)(o.Z,{})}),(0,S.jsx)(h.Z.Item,{name:"email",label:(0,S.jsx)(D.Z,{id:"email"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})},{type:"email",message:"\u0418-\u043c\u044d\u0439\u043b \u0443\u0442\u0433\u0430 \u0431\u0443\u0440\u0443\u0443 \u0431\u0430\u0439\u043d\u0430"}],children:(0,S.jsx)(o.Z,{})}),(0,S.jsx)(h.Z.Item,{name:"address",label:(0,S.jsx)(D.Z,{id:"address"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})}],children:(0,S.jsx)(c,{rows:2})}),(0,S.jsx)(h.Z.Item,{name:"username",label:(0,S.jsx)(D.Z,{id:"username"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})},{validator:function(e,i){return t=i,(null===z||void 0===z?void 0:z.allUsers.some((function(e){return("edit"!==s||r.user.username!==t)&&e.username===t})))?Promise.reject("\u041d\u044d\u0432\u0442\u0440\u044d\u0445 \u043d\u044d\u0440 \u0431\u04af\u0440\u0442\u0433\u044d\u043b\u0442\u044d\u0439 \u0431\u0430\u0439\u043d\u0430"):Promise.resolve();var t}}],children:(0,S.jsx)(o.Z,{})}),"create"===s?(0,S.jsx)(h.Z.Item,{name:"password",label:(0,S.jsx)(D.Z,{id:"password"}),rules:[{required:!0,message:(0,S.jsx)(D.Z,{id:"form.required"})},{min:8,message:"\u041d\u0443\u0443\u0446 \u04af\u0433 8-\u0430\u0430\u0441 \u0443\u0440\u0442\u0442\u0430\u0439 \u0434\u044d\u044d\u0448 \u0431\u0430\u0439\u0445 \u0451\u0441\u0442\u043e\u0439"},function(e){var r=e.getFieldValue;return{validator:function(e,s){return s&&r("username")!==s?Promise.resolve():Promise.reject("\u041d\u044d\u0432\u0442\u0440\u044d\u0445 \u043d\u044d\u0440 \u043d\u0443\u0443\u0446 \u04af\u0433 \u0445\u043e\u0451\u0440 \u0438\u0436\u0438\u043b \u0431\u0430\u0439\u0445 \u0431\u043e\u043b\u043e\u043c\u0433\u04af\u0439!")}}}],children:(0,S.jsx)(o.Z.Password,{})}):null]})]})})})},M=s(64856),_=s(36319),E=n.Z.confirm;var O=function(e){var r=(0,i.useState)([]),s=(0,t.Z)(r,2),h=s[0],p=s[1],v=(0,i.useState)(""),b=(0,t.Z)(v,2),y=b[0],g=b[1],w=(0,i.useState)(!1),k=(0,t.Z)(w,2),T=k[0],N=k[1],P=(0,i.useState)({}),F=(0,t.Z)(P,2),O=F[0],V=F[1],z=(0,i.useState)(""),A=(0,t.Z)(z,2),$=A[0],K=A[1],R=(0,q.a)(I.Vr,{variables:{filter:y},onCompleted:function(e){p(e.allEmployees)}}),B=R.loading,G=R.refetch,L=(0,C.D)(M.Tu,{onCompleted:function(e){G(),a.ZP.success("\u0410\u043c\u0436\u0438\u043b\u0442\u0442\u0430\u0439 \u0443\u0441\u0442\u043b\u0430\u0430")}}),U=(0,t.Z)(L,1)[0],H=[{key:"employeeCode",title:(0,S.jsx)(D.Z,{id:"employeeCode"}),dataIndex:"employeeCode",sorter:function(e,r){return f.ZP.antdTableSorter(e,r,"employeeCode")}},{key:"familyName",title:(0,S.jsx)(D.Z,{id:"familyName"}),dataIndex:"familyName",sorter:function(e,r){return f.ZP.antdTableSorter(e,r,"code")}},{key:"name",title:(0,S.jsx)(D.Z,{id:"name"}),dataIndex:"name",sorter:function(e,r){return f.ZP.antdTableSorter(e,r,"name")}},{key:"name",title:"\u0410\u043b\u0431\u0430\u043d \u0442\u0443\u0448\u0430\u0430\u043b",dataIndex:"name",render:function(e,r){var s;return null===(s=r.user.groups)||void 0===s?void 0:s.map((function(e,r){return(0,S.jsxs)("span",{children:[e.name," ",(0,S.jsx)("br",{})]},r)}))}},{key:"compartment",title:(0,S.jsx)(D.Z,{id:"compartment"}),dataIndex:["compartment","name"],sorter:function(e,r){return f.ZP.antdTableSorter(e,r,"compartment")}},{key:"phone",title:(0,S.jsx)(D.Z,{id:"phone"}),dataIndex:"phone",sorter:function(e,r){return f.ZP.antdTableSorter(e,r,"phone")},render:function(e){return(0,S.jsx)("span",{children:e.substr(0,4)+"-"+e.substr(4,9)})}}];return!0!==e.permissions.edit&&!0!==e.permissions.destroy||H.push({key:"actions",title:(0,S.jsx)(D.Z,{id:"main.action"}),width:"15vw",dataIndex:"actions",render:function(r,s){return(0,S.jsxs)("div",{className:"text-center",children:[e.permissions.password&&(0,S.jsx)(_.Z,{user:s.user.id}),!0===e.permissions.edit&&(0,S.jsxs)(d.Z,{size:"small",onClick:function(){return function(e){K("edit"),V(e),N(!0)}(s)},type:"text",icon:(0,S.jsx)(u.Z,{twoToneColor:"#ffdb00"}),children:[" ",(0,S.jsx)(D.Z,{id:"edit"})]}),!0===e.permissions.destroy&&(0,S.jsxs)(d.Z,{size:"small",onClick:function(){return function(e){E({title:"\u0423\u0441\u0442\u0433\u0430\u0445 \u0443\u0443?",okText:"\u0423\u0441\u0442\u0433\u0430\u0445",okType:"danger",cancelText:"\u0411\u043e\u043b\u0438\u0445",onOk:function(){U({variables:{id:e.id}})}})}(s)},type:"text",icon:(0,S.jsx)(c.Z,{twoToneColor:"#f42f2f"}),children:[" ",(0,S.jsx)(D.Z,{id:"delete"})]})]})}}),(0,S.jsxs)(S.Fragment,{children:[e.permissions.create||!0===e.permissions.edit?(0,S.jsx)(n.Z,{title:"create"===$?(0,S.jsx)(D.Z,{id:"add_new1"}):(0,S.jsx)(D.Z,{id:"edit"}),visible:T,width:"80vw",okText:(0,S.jsx)(D.Z,{id:"main.okText"}),cancelText:(0,S.jsx)(D.Z,{id:"main.cancelText"}),onCancel:function(){N(!1)},okButtonProps:{form:"TeacherForm",key:"submit",htmlType:"submit"},children:(0,S.jsx)(Y,{refetch:G,formType:$,editData:O,setIsModalVisible:N})}):null,(0,S.jsxs)(l.Z,{children:[(0,S.jsxs)(Z.Z,{alignItems:"center",justifyContent:"between",mobileFlex:!1,children:[(0,S.jsx)(Z.Z,{className:"mb-1",mobileFlex:!1,children:(0,S.jsx)("div",{className:"mr-md-3 mb-3",children:(0,S.jsx)(o.Z,{placeholder:"\u0425\u0430\u0439\u0445",prefix:(0,S.jsx)(x.Z,{}),onChange:function(e){return function(e){var r=e.currentTarget.value;g(r)}(e)}})})}),!0===e.permissions.create?(0,S.jsx)("div",{className:"mr-md-3 mb-3",children:(0,S.jsxs)(d.Z,{onClick:function(){K("create"),N(!0)},type:"primary",icon:(0,S.jsx)(j.Z,{}),block:!0,children:[" ",(0,S.jsx)(D.Z,{id:"add_new"})]})}):null]}),(0,S.jsx)("div",{className:"table-responsive",children:(0,S.jsx)(m.Z,{size:"small",columns:H,dataSource:h,rowKey:"id",bordered:!0,loading:B})})]})]})},V=s(59288),z=s(38937),A=function(e){var r={create:(0,V.C)("add_employee"),edit:(0,V.C)("change_employee"),destroy:(0,V.C)("delete_employee"),password:(0,V.C)("change_user_password")};return Object.values(r).indexOf("loading")>-1?(0,S.jsx)(z.Z,{cover:"content"}):(0,S.jsx)(O,{title:e.title,permissions:r})}}}]);
//# sourceMappingURL=2223.f69ddbee.chunk.js.map