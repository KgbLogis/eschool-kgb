"use strict";(self.webpackChunkmkp=self.webpackChunkmkp||[]).push([[5987],{49696:function(e,n,t){var r=t(29439),i=t(72791),a=t(20003),l=t(80184),s=(0,i.forwardRef)((function(e,n){var t,s=e.children,o=e.title,d=e.footer,c=e.formName,m=void 0===c?"form":c,u=e.forceRender,f=void 0!==u&&u,x=(0,i.useState)(!1),p=(0,r.Z)(x,2),g=p[0],h=p[1];return(0,i.useImperativeHandle)(n,(function(){return{handleOpen:function(){h(!0)},handleCancel:function(){h(!1)}}})),(0,l.jsx)(a.Z,{width:1e3,title:o,visible:g,onCancel:null===(t=n.current)||void 0===t?void 0:t.handleCancel,okText:"\u0425\u0430\u0434\u0433\u0430\u043b\u0430\u0445",footer:d,cancelText:"\u0411\u043e\u043b\u0438\u0445",forceRender:f,okButtonProps:{form:m,key:"submit",htmlType:"submit"},children:s})}));n.Z=s},68694:function(e,n,t){t.d(n,{Cm:function(){return g},Cx:function(){return x},FQ:function(){return p},JX:function(){return f},Z2:function(){return j},dT:function(){return h},gt:function(){return Z},tL:function(){return T}});var r,i,a,l,s,o,d,c,m=t(30168),u=t(27570),f=(0,u.Ps)(r||(r=(0,m.Z)(["\n    query allStudents ($filter: String) {\n        allStudents (filter: $filter) {\n            id\n            familyName\n            name\n            studentCode\n        }\n\t}\n"]))),x=(0,u.Ps)(i||(i=(0,m.Z)(["\n    query allTeachers ($filter: String) {\n        allTeachers (filter: $filter) {\n            id\n            familyName\n            name\n            teacherCode\n        }\n    }\n"]))),p=(0,u.Ps)(a||(a=(0,m.Z)(["\n    query allClassess ($filter: String, $program: Int) {\n        allClassess (filter: $filter, program: $program) {\n            id\n            classes\n        }\n\t}\n"]))),g=(0,u.Ps)(l||(l=(0,m.Z)(['\n    query allSubjects ($offset: Int!, $limit: Int!, $filter: String) {\n        count (appName: "subject", modelName: "Subject", filter: $filter) {\n            count\n        }\n        allSubjects (offset: $offset, limit: $limit, filter: $filter) {\n            id\n            subject\n            content\n            createUserid {\n                firstName\n                lastName\n            }\n        }\n    }\n']))),h=(0,u.Ps)(s||(s=(0,m.Z)(["\n    query selectProgram {\n        allPrograms {\n            id\n            program\n        }\n    }\n"]))),T=(0,u.Ps)(o||(o=(0,m.Z)(["\n    query sectionsByProgram ($program: Int!) {\n        sectionsByProgram (program: $program) {\n            id\n            section \n            classes {\n                classes\n            }\n        }\n    }\n"]))),Z=(0,u.Ps)(d||(d=(0,m.Z)(["\n    query sectionsByClasses ($classes: Int!){\n        sectionsByClasses (classes: $classes) {\n            id \n            section\n        }\n    }\n"]))),j=(0,u.Ps)(c||(c=(0,m.Z)(['\n    query allStudentsPagination (\n        $page: Int\n        $perPage: Int\n        $filter: String = ""\n    ) {\n        allStudentsPagination (\n            page: $page\n            perPage: $perPage\n            filter: $filter\n        ) {\n            page\n            perPage\n            pageCount\n            totalCount\n            records {\n                id\n                name\n                familyName\n            }\n        }\n    }\n'])))},65987:function(e,n,t){t.r(n),t.d(n,{default:function(){return M}});var r,i,a,l,s,o,d,c,m=t(29439),u=t(72791),f=t(96578),x=t(84376),p=t(31549),g=t(38937),h=t(30168),T=t(27570),Z=(0,T.Ps)(r||(r=(0,h.Z)(["\n  query allFlexTimes {\n        allFlexTimes {\n            id\n            program {\n                id\n                program\n            }\n            isCurrent\n        }\n    }\n"]))),j=(0,T.Ps)(i||(i=(0,h.Z)(["\n    mutation createFlexTime($isCurrent: Boolean, $program: ID) {\n        createFlexTime (isCurrent: $isCurrent, program: $program) {\n            flexTime {\n                isCurrent\n            }\n        }\n    }\n"]))),v=(0,T.Ps)(a||(a=(0,h.Z)(["\n    mutation updateFlexTime($id: ID, $isCurrent: Boolean, $program: ID) {\n        updateFlexTime (id: $id, isCurrent: $isCurrent, program: $program) {\n            flexTime {\n                isCurrent\n            }\n        }\n    }\n"]))),$=(0,T.Ps)(l||(l=(0,h.Z)(["\n    mutation deleteFlexTime ($id: ID) {\n        deleteFlexTime (id: $id) {\n            flexTime {\n                isCurrent\n            }\n        }\n    }\n"]))),b=(0,T.Ps)(s||(s=(0,h.Z)(["\n    query allFlexTimeSubs ($flexTime: ID!) {\n        allFlexTimeSubs (flexTime: $flexTime) {\n            id\n            flexTime {\n                id\n            }\n            action\n            content\n            startAt\n            endAt\n        }\n    }\n"]))),C=(0,T.Ps)(o||(o=(0,h.Z)(["\n    mutation createFlexTimeSub(\n        $action: String\n        $content: String\n        $endAt: Time\n        $flexTime: ID\n        $startAt: Time\n    ) {\n        createFlexTimeSub  (\n            action: $action\n            content: $content\n            endAt: $endAt\n            flexTime: $flexTime\n            startAt: $startAt\n        ) {\n            flexTimeSub {\n                startAt\n            }\n        }\n    }\n"]))),S=(0,T.Ps)(d||(d=(0,h.Z)(["\n    mutation updateFlexTimeSub(\n        $id: ID\n        $action: String\n        $content: String\n        $endAt: Time\n        $flexTime: ID\n        $startAt: Time\n    ) {\n        updateFlexTimeSub (\n            action: $action\n            content: $content\n            endAt: $endAt\n            flexTime: $flexTime\n            id: $id\n            startAt: $startAt\n        ) {\n            flexTimeSub {\n                startAt\n            }\n        }\n    }\n"]))),F=(0,T.Ps)(c||(c=(0,h.Z)(["\n    mutation deleteFlexTimeSub ($id: ID) {\n        deleteFlexTimeSub (id: $id) {\n            flexTimeSub {\n                startAt\n            }\n        }\n    }\n"]))),y=t(2703),P=t(1413),k=t(73332),N=t(37083),_=t(49389),A=t(97943),q=t(72426),I=t.n(q),w=t(82630),D=t(80184);function R(e){var n=e.handleCancel,t=e.flexTime,r=e.flexTimeSub,i=k.Z.useForm(),a=(0,m.Z)(i,1)[0],l=(0,x.D)(C,{refetchQueries:[{query:b,variables:{flexTime:t}}],onCompleted:function(e){n()}}),s=(0,m.Z)(l,2),o=s[0],d=s[1].loading,c=(0,x.D)(S,{refetchQueries:[{query:b,variables:{flexTime:t}}],onCompleted:function(e){n()}}),f=(0,m.Z)(c,2),p=f[0],g=f[1].loading;return(0,u.useEffect)((function(){r&&a.setFieldsValue((0,P.Z)({start_end_date:[I()("2022-03-13 ".concat(r.startAt)),I()("2022-03-13 ".concat(r.endAt))]},r))}),[a,r]),(0,D.jsx)(N.Z,{tip:"\u0410\u0447\u0430\u0430\u043b\u043b\u0430\u0436 \u0431\u0430\u0439\u043d\u0430...",spinning:g||d,children:(0,D.jsxs)(k.Z,{id:"FlexTimeSubForm",layout:"vertical",form:a,name:"FlexTimeSubForm",onFinish:function(e){e.startAt=e.start_end_date[0].format("HH:mm:ss"),e.endAt=e.start_end_date[1].format("HH:mm:ss"),e.flexTime=t,r?(e.id=r.id,p({variables:e})):o({variables:e})},children:[(0,D.jsx)(k.Z.Item,{name:"action",label:(0,D.jsx)(w.Z,{id:"flexTimeAction"}),rules:[{required:!0,message:(0,D.jsx)(w.Z,{id:"form.required"})}],children:(0,D.jsx)(_.Z,{})}),(0,D.jsx)(k.Z.Item,{name:"start_end_date",label:(0,D.jsx)(w.Z,{id:"start_end_date"}),rules:[{required:!0,message:(0,D.jsx)(w.Z,{id:"form.required"})}],children:(0,D.jsx)(A.Z.RangePicker,{format:"HH:mm"})}),(0,D.jsx)(k.Z.Item,{name:"content",label:(0,D.jsx)(w.Z,{id:"content"}),rules:[{required:!0,message:(0,D.jsx)(w.Z,{id:"form.required"})}],children:(0,D.jsx)(_.Z.TextArea,{})})]})})}var B=t(49696),H=t(20003),O=t(87309),Q=t(59288),E=t(28155),V=t(5369),J=t(22949),K=t(25581),L=t(68694),U=J.Z.Option;function X(e){var n=e.handleCancel,t=e.flexTime,r=k.Z.useForm(),i=(0,m.Z)(r,1)[0],a=(0,f.a)(L.dT).data,l=(0,x.D)(j,{refetchQueries:[{query:Z}],onCompleted:function(e){n()}}),s=(0,m.Z)(l,2),o=s[0],d=s[1].loading,c=(0,x.D)(v,{refetchQueries:[{query:Z}],onCompleted:function(e){n()}}),p=(0,m.Z)(c,2),g=p[0],h=p[1].loading;return(0,u.useEffect)((function(){t&&i.setFieldsValue({program:t.program.id,isCurrent:t.isCurrent})}),[i,t]),(0,D.jsx)(N.Z,{tip:"\u0410\u0447\u0430\u0430\u043b\u043b\u0430\u0436 \u0431\u0430\u0439\u043d\u0430...",spinning:h||d,children:(0,D.jsxs)(k.Z,{id:"FlexTimeForm",layout:"vertical",form:i,name:"FlexTimeForm",onFinish:function(e){t?(e.id=t.id,g({variables:e})):o({variables:e})},children:[(0,D.jsx)(k.Z.Item,{name:"program",label:(0,D.jsx)(w.Z,{id:"program"}),rules:[{required:!0,message:(0,D.jsx)(w.Z,{id:"form.required"})}],children:(0,D.jsx)(J.Z,{children:null===a||void 0===a?void 0:a.allPrograms.map((function(e){return(0,D.jsx)(U,{value:e.id,children:e.program},e.id)}))})}),(0,D.jsx)(k.Z.Item,{name:"isCurrent",label:(0,D.jsx)(w.Z,{id:"isCurrent"}),valuePropName:"checked",rules:[{required:!0,message:(0,D.jsx)(w.Z,{id:"form.required"})}],children:(0,D.jsx)(K.Z,{checkedChildren:"\u04ae\u043d\u0434\u0441\u044d\u043d",unCheckedChildren:"\u04ae\u043d\u0434\u0441\u044d\u043d \u0431\u0438\u0448"})})]})})}var z=H.Z.confirm;function G(e){var n=e.flexTime,t=(0,u.useRef)(),r={create:(0,Q.C)("add_flex_time_sub"),update:(0,Q.C)("change_flex_time_sub"),delete:(0,Q.C)("delete_flex_time_sub")},i=(0,f.a)(b,{variables:{flexTime:n}}),a=i.data,l=i.loading,s=i.refetch,o=(0,x.D)(F,{onCompleted:function(e){s()}}),d=(0,m.Z)(o,1)[0],c=(0,u.useState)(void 0),h=(0,m.Z)(c,2),T=h[0],Z=h[1];function j(e){var n=e.flexTimeSub;r.update&&(t.current.handleOpen(),Z(n))}return l?(0,D.jsx)(g.Z,{cover:"content"}):(0,D.jsxs)(D.Fragment,{children:[r.update&&(0,D.jsx)(B.Z,{ref:t,formName:"FlexTimeSubForm",forceRender:!0,children:(0,D.jsx)(R,{handleCancel:function(){t.current.handleCancel(),Z(void 0)},flexTime:n,flexTimeSub:T})}),(0,D.jsx)("div",{className:"flex justify-end mb-4",children:r.create&&(0,D.jsxs)(O.Z,{onClick:function(){return j({flexTimeSub:void 0})},type:"primary",icon:(0,D.jsx)(p.Z,{}),children:[" ",(0,D.jsx)(w.Z,{id:"add_new"})]})}),(0,D.jsx)("div",{className:"space-y-2",children:null===a||void 0===a?void 0:a.allFlexTimeSubs.map((function(e,n){return(0,D.jsxs)("div",{className:"relative flex flex-row gap-3 rounded-2 bg-mkp-200 hover:cursor-pointer",onClick:function(){return j({flexTimeSub:e})},children:[r.delete&&(0,D.jsx)("div",{className:"absolute right-0 p-2",onClick:function(e){return e&&e.stopPropagation&&e.stopPropagation()},children:(0,D.jsx)(E.Z,{className:"h-4 w-4 hover:text-red-500",onClick:function(){return n=e.id,void z({title:"\u0423\u0441\u0442\u0433\u0430\u0445 \u0443\u0443?",okText:"\u0423\u0441\u0442\u0433\u0430\u0445",okType:"danger",cancelText:"\u0411\u043e\u043b\u0438\u0445",onOk:function(){d({variables:{id:n}})}});var n}})}),(0,D.jsxs)("div",{className:"flex flex-col items-center justify-center w-20 gap-2 mx-4 text-slate-600",children:[(0,D.jsx)("span",{className:'mt-2 after:content-[""] after:border-l-4 after:h-20 after:w-0 after:mx-auto after:border-slate-600 after:block after:rounded-2',children:e.startAt.slice(0,5).toString()}),(0,D.jsx)("span",{className:"mb-2",children:e.endAt.slice(0,5).toString()})]}),(0,D.jsxs)("div",{className:"py-4",children:[(0,D.jsx)("p",{className:"text-xl font-bold",children:e.action}),(0,D.jsx)("div",{className:"text-sm text-slate-600",children:e.content})]})]},n)}))})]})}function M(){var e=(0,u.useRef)(),n=(0,u.useState)(void 0),t=(0,m.Z)(n,2),r=t[0],i=t[1],a={create:(0,Q.C)("add_flex_time"),update:(0,Q.C)("change_flex_time"),delete:(0,Q.C)("delete_flex_time")},l=(0,f.a)(Z),s=l.data,o=l.loading,d=l.refetch,c=(0,x.D)($,{onCompleted:function(e){d(),i(void 0)}}),h=(0,m.Z)(c,1)[0];function T(n){var t=n.flexTime;a.update&&(e.current.handleOpen(),i(t))}return o?(0,D.jsx)(g.Z,{cover:"content"}):(0,D.jsx)(D.Fragment,{children:(0,D.jsxs)("div",{className:"max-w-5xl mx-auto",children:[a.update&&(0,D.jsx)(B.Z,{ref:e,formName:"FlexTimeForm",forceRender:!0,children:(0,D.jsx)(X,{handleCancel:function(){e.current.handleCancel()},flexTime:r})}),(0,D.jsx)("div",{className:"flex justify-end mb-4",children:a.create&&(0,D.jsxs)(O.Z,{onClick:function(){return T({flexTime:void 0})},type:"primary",icon:(0,D.jsx)(p.Z,{}),children:[" ",(0,D.jsx)(w.Z,{id:"add_new"})]})}),(0,D.jsx)("div",{className:"mb-4",children:(0,D.jsx)("div",{className:"flex flex-wrap gap-5",children:s.allFlexTimes.map((function(e,n){return(0,D.jsxs)("div",{onClick:function(){return function(e){i(e)}(e)},className:(0,y.AK)(r===e?"bg-mkp-300":"bg-mkp-200","relative flex-grow basis-60 text-center rounded-2 hover:cursor-pointer"),children:[a.delete&&(0,D.jsxs)("div",{className:"absolute right-0 p-2 flex gap-2",onClick:function(e){return e&&e.stopPropagation&&e.stopPropagation()},children:[(0,D.jsx)(V.Z,{className:"h-4 w-4 hover:text-yellow-500",onClick:function(){return T({flexTime:e})}}),(0,D.jsx)(E.Z,{className:"h-4 w-4 hover:text-red-500",onClick:function(){return n=e.id,void z({title:"\u0423\u0441\u0442\u0433\u0430\u0445 \u0443\u0443?",okText:"\u0423\u0441\u0442\u0433\u0430\u0445",okType:"danger",cancelText:"\u0411\u043e\u043b\u0438\u0445",onOk:function(){h({variables:{id:n}})}});var n}})]}),(0,D.jsx)("p",{className:"p-4 ",children:e.program.program})]},n)}))})}),r&&(0,D.jsx)(G,{flexTime:r.id})]})})}}}]);
//# sourceMappingURL=5987.a0d849f2.chunk.js.map