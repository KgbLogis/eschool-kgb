"use strict";(self.webpackChunkemind=self.webpackChunkemind||[]).push([[6487],{68470:function(e,r,s){s(72791);var i=s(80184),t=function(e){var r=e.children,s=e.className,t=e.alignItems,n=e.justifyContent,a=e.mobileFlex,d=e.flexDirection;return(0,i.jsx)("div",{className:"".concat(a?"d-flex":"d-md-flex"," ").concat(s," ").concat(d?"flex-"+d:""," ").concat(t?"align-items-"+t:""," ").concat(n?"justify-content-"+n:""),children:r})};t.defaultProps={mobileFlex:!0,flexDirection:"row",className:""},r.Z=t},76487:function(e,r,s){s.r(r),s.d(r,{default:function(){return z}});var i=s(72791),t=s(29439),n=s(20003),a=s(50419),d=s(87309),l=s(66871),o=s(49389),c=s(59432),u=s(36795),m=s(82464),x=s(11730),j=s(31549),h=s(68470),Z=s(2703),f=s(73332),b=s(22949),p=s(37083),v=s(66106),g=s(30914),y=s(11561),q=s(84376),C=s(96578),D=s(41920),I=s(20077),w=s(82259),T=s(7378),N=s(72426),S=s.n(N),k=s(82630),P=s(80184);var Y=function(e){var r=e.editData,s=e.formType,n=e.setIsModalVisible,d=e.refetch,l=f.Z.useForm(),c=(0,t.Z)(l,1)[0],u=b.Z.Option,m=o.Z.TextArea,x="YYYY-MM-DD",j=(0,q.D)(I.JO,{onCompleted:function(e){a.ZP.success("\u0410\u043c\u0436\u0438\u043b\u0442\u0442\u0430\u0439 \u0445\u0430\u0434\u0433\u0430\u043b\u043b\u0430\u0430"),c.resetFields(),n(!1),d()}}),h=(0,t.Z)(j,2),Z=h[0],N=h[1].loading,Y=(0,q.D)(w.Gr,{onCompleted:function(e){a.ZP.success("\u0410\u043c\u0436\u0438\u043b\u0442\u0442\u0430\u0439 \u0445\u0430\u0434\u0433\u0430\u043b\u043b\u0430\u0430"),c.resetFields(),n(!1),d()}}),F=(0,t.Z)(Y,2),M=F[0],_=F[1].loading,E=(0,C.a)(T.wZ,{}).data,O=(0,C.a)(D.$_,{}).data,B=(0,C.a)(D.NC,{}).data,V=(0,C.a)(D.Fm,{}).data,z=(0,C.a)(D.O8,{}).data,$=(0,C.a)(T.l4,{}).data,A=(0,C.a)(D.gw,{}).data;(0,i.useEffect)((function(){if("edit"===s){var e={name:r.name,teacherCode:r.teacherCode,familyName:r.familyName,access:r.access.match(/\d+/g),registerNo:r.registerNo,phone:r.phone,phone2:r.phone2,address:r.address,degree:r.degree.id,joinTeacherBefore:r.joinTeacherBefore,sex:r.sex,birthCity:r.birthCity.id,birthDistrict:r.birthDistrict.id,status:r.status.id,school:r.school.id,subSchool:r.subSchool.id,id:r.id,username:r.user.username,email:r.user.email,joinDate:S()(r.joinDate),birthdate:S()(r.birthdate)};J(e.birthCity),X(e.school),ne(S()(e.joinDate).format("YYYY-MM-DD")),oe(S()(e.birthdate).format("YYYY-MM-DD")),c.setFieldsValue(e)}else"create"===s&&c.resetFields()}),[c,r,s]);var R=(0,i.useState)(""),G=(0,t.Z)(R,2),H=G[0],J=G[1],K=null,Q=null;H&&(K=H),K&&(Q=null===B||void 0===B?void 0:B.allDistricts.filter((function(e){return e.cityID.id===K})).map((function(e){return(0,P.jsx)(u,{value:e.id,children:e.name},e.id)})));var U=(0,i.useState)(""),L=(0,t.Z)(U,2),W=L[0],X=L[1],ee=null,re=null;W&&(ee=W),ee&&(re=null===z||void 0===z?void 0:z.allSubSchools.filter((function(e){return e.school.id===ee})).map((function(e){return(0,P.jsx)(u,{value:e.id,children:e.name},e.id)})));var se=(0,i.useState)(""),ie=(0,t.Z)(se,2),te=ie[0],ne=ie[1],ae=(0,i.useState)(""),de=(0,t.Z)(ae,2),le=de[0],oe=de[1],ce=new RegExp(/^[7-9][0-9]{3}[0-9]{4}$/),ue=new RegExp(/[\u0401\u0410-\u042F\u04AE\u04E8]{2}([0-9]){8}$/);return(0,P.jsx)(p.Z,{spinning:N||_,tip:"\u0410\u0447\u0430\u0430\u043b\u043b\u0430\u0436 \u0431\u0430\u0439\u043d\u0430...",children:(0,P.jsx)(f.Z,{id:"TeacherForm",layout:"vertical",form:c,name:"control-hooks",onFinish:function(e){"edit"===s?(e.id=r.id,e.joinDate=te,e.birthdate=le,M({variables:e})):(e.joinDate=te,e.birthdate=le,Z({variables:e}))},children:(0,P.jsxs)(v.Z,{gutter:[16,24],children:[(0,P.jsxs)(g.Z,{className:"gutter-row",span:12,children:[(0,P.jsx)(f.Z.Item,{name:"familyName",label:(0,P.jsx)(k.Z,{id:"familyName"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsx)(o.Z,{})}),(0,P.jsx)(f.Z.Item,{name:"name",label:(0,P.jsx)(k.Z,{id:"name"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsx)(o.Z,{})}),(0,P.jsx)(f.Z.Item,{name:"registerNo",label:(0,P.jsx)(k.Z,{id:"registerNo"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})},{validator:function(e,r){return ue.test(r)?Promise.resolve():Promise.reject("\u0420\u0435\u0433\u0438\u0441\u0442\u0435\u0440\u0438\u0439\u043d \u0434\u0443\u0433\u0430\u0430\u0440 \u0431\u0443\u0440\u0443\u0443 \u0431\u0430\u0439\u043d\u0430!")}}],children:(0,P.jsx)(o.Z,{})}),(0,P.jsx)(f.Z.Item,{name:"birthdate",label:(0,P.jsx)(k.Z,{id:"birthdate"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsx)(y.Z,{style:{width:"100%"},onChange:function(e){oe(S()(e).format("YYYY-MM-DD"))},format:x})}),(0,P.jsx)(f.Z.Item,{name:"sex",label:(0,P.jsx)(k.Z,{id:"sex"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsxs)(b.Z,{children:[(0,P.jsx)(u,{value:"\u042d\u0440\u044d\u0433\u0442\u044d\u0439",children:(0,P.jsx)(k.Z,{id:"sex.male"})},"0"),(0,P.jsx)(u,{value:"\u042d\u043c\u044d\u0433\u0442\u044d\u0439",children:(0,P.jsx)(k.Z,{id:"sex.female"})},"1")]})}),(0,P.jsx)(f.Z.Item,{name:"birthCity",label:(0,P.jsx)(k.Z,{id:"birthCity"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsx)(b.Z,{onChange:function(e){J(e)},children:null===O||void 0===O?void 0:O.allCitys.map((function(e,r){return(0,P.jsx)(u,{value:e.id,children:e.name},r)}))})}),(0,P.jsx)(f.Z.Item,{name:"birthDistrict",label:(0,P.jsx)(k.Z,{id:"birthDistrict"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsx)(b.Z,{children:Q})}),(0,P.jsx)(f.Z.Item,{name:"school",label:(0,P.jsx)(k.Z,{id:"main-school"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsx)(b.Z,{onChange:function(e){X(e)},children:null===V||void 0===V?void 0:V.allSchools.map((function(e,r){return(0,P.jsx)(u,{value:e.id,children:e.name},r)}))})}),(0,P.jsx)(f.Z.Item,{name:"subSchool",label:(0,P.jsx)(k.Z,{id:"sub-school"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsx)(b.Z,{children:re})}),(0,P.jsx)(f.Z.Item,{name:"teacherCode",label:(0,P.jsx)(k.Z,{id:"teacherCode"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsx)(o.Z,{})}),(0,P.jsx)(f.Z.Item,{name:"status",label:(0,P.jsx)(k.Z,{id:"status"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsx)(b.Z,{children:null===$||void 0===$?void 0:$.allTeacherStatuss.map((function(e,r){return(0,P.jsx)(u,{value:e.id,children:e.name},r)}))})})]}),(0,P.jsxs)(g.Z,{className:"gutter-row",span:12,children:[(0,P.jsx)(f.Z.Item,{name:"joinBefore",label:(0,P.jsx)(k.Z,{id:"joinTeacherBefore"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsx)(m,{rows:4})}),(0,P.jsx)(f.Z.Item,{name:"degree",label:(0,P.jsx)(k.Z,{id:"degree"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsx)(b.Z,{children:null===E||void 0===E?void 0:E.allDegrees.map((function(e,r){return(0,P.jsx)(u,{value:e.id,children:e.name},r)}))})}),(0,P.jsx)(f.Z.Item,{name:"joinDate",label:(0,P.jsx)(k.Z,{id:"joinDate2"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsx)(y.Z,{style:{width:"100%"},onChange:function(e){ne(S()(e).format("YYYY-MM-DD"))},format:x})}),(0,P.jsx)(f.Z.Item,{name:"phone",label:(0,P.jsx)(k.Z,{id:"phone1"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})},{validator:function(e,r){return ce.test(r)?Promise.resolve():Promise.reject("\u0423\u0442\u0430\u0441\u043d\u044b \u0434\u0443\u0433\u0430\u0430\u0440 \u0431\u0443\u0440\u0443\u0443 \u0431\u0430\u0439\u043d\u0430!")}}],children:(0,P.jsx)(o.Z,{})}),(0,P.jsx)(f.Z.Item,{name:"phone2",label:(0,P.jsx)(k.Z,{id:"phone2"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})},{validator:function(e,r){return ce.test(r)?Promise.resolve():Promise.reject("\u0423\u0442\u0430\u0441\u043d\u044b \u0434\u0443\u0433\u0430\u0430\u0440 \u0431\u0443\u0440\u0443\u0443 \u0431\u0430\u0439\u043d\u0430!")}}],children:(0,P.jsx)(o.Z,{})}),(0,P.jsx)(f.Z.Item,{name:"access",label:(0,P.jsx)(k.Z,{id:"access"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsxs)(b.Z,{children:[(0,P.jsx)(u,{value:"1",children:(0,P.jsx)(k.Z,{id:"teacher"})}),(0,P.jsx)(u,{value:"2",children:(0,P.jsx)(k.Z,{id:"sectionTeacher"})})]})}),(0,P.jsx)(f.Z.Item,{name:"email",label:(0,P.jsx)(k.Z,{id:"email"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsx)(o.Z,{})}),(0,P.jsx)(f.Z.Item,{name:"address",label:(0,P.jsx)(k.Z,{id:"address"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})}],children:(0,P.jsx)(m,{rows:2})}),(0,P.jsx)(f.Z.Item,{name:"username",label:(0,P.jsx)(k.Z,{id:"username"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})},{validator:function(e,i){return t=i,(null===A||void 0===A?void 0:A.allUsers.some((function(e){return("edit"!==s||r.user.username!==t)&&e.username===t})))?Promise.reject("\u041d\u044d\u0432\u0442\u0440\u044d\u0445 \u043d\u044d\u0440 \u0431\u04af\u0440\u0442\u0433\u044d\u043b\u0442\u044d\u0439 \u0431\u0430\u0439\u043d\u0430"):Promise.resolve();var t}}],children:(0,P.jsx)(o.Z,{})}),"create"===s?(0,P.jsx)(f.Z.Item,{name:"password",label:(0,P.jsx)(k.Z,{id:"password"}),rules:[{required:!0,message:(0,P.jsx)(k.Z,{id:"form.required"})},{min:8,message:"\u041d\u0443\u0443\u0446 \u04af\u0433 8-\u0430\u0430\u0441 \u0443\u0440\u0442\u0442\u0430\u0439 \u0434\u044d\u044d\u0448 \u0431\u0430\u0439\u0445 \u0451\u0441\u0442\u043e\u0439"},function(e){var r=e.getFieldValue;return{validator:function(e,s){return s&&r("username")!==s?Promise.resolve():Promise.reject("\u041d\u044d\u0432\u0442\u0440\u044d\u0445 \u043d\u044d\u0440 \u043d\u0443\u0443\u0446 \u04af\u0433 \u0445\u043e\u0451\u0440 \u0438\u0436\u0438\u043b \u0431\u0430\u0439\u0445 \u0431\u043e\u043b\u043e\u043c\u0433\u04af\u0439!")}}}],children:(0,P.jsx)(o.Z.Password,{})}):null]})]})})})},F=s(86586),M=s(64856),_=s(36319),E=n.Z.confirm;var O=function(e){var r=(0,i.useState)([]),s=(0,t.Z)(r,2),f=s[0],b=s[1],p="Teacher",v="teacher",g=(0,i.useState)(!1),y=(0,t.Z)(g,2),C=y[0],I=y[1],w=(0,i.useState)({}),T=(0,t.Z)(w,2),N=T[0],S=T[1],O=(0,i.useState)(""),B=(0,t.Z)(O,2),V=B[0],z=B[1],$=(0,F.t)(D.pQ,{fetchPolicy:"network-only",onCompleted:function(e){b(e.allTeachers)}}),A=(0,t.Z)($,2),R=A[0],G=A[1],H=G.loading,J=G.refetch,K=(0,q.D)(M.NH,{onCompleted:function(e){J(),a.ZP.success("\u0410\u043c\u0436\u0438\u043b\u0442\u0442\u0430\u0439 \u0443\u0441\u0442\u043b\u0430\u0430")}}),Q=(0,t.Z)(K,1)[0];(0,i.useEffect)((function(){R({variables:{offset:0,limit:9,filter:"",modelName:p,appName:v}})}),[R]);var U=[{key:"teacherCode",title:(0,P.jsx)(k.Z,{id:"teacherCode"}),dataIndex:"teacherCode",sorter:function(e,r){return Z.ZP.antdTableSorter(e,r,"teacherCode")}},{key:"familyName",title:(0,P.jsx)(k.Z,{id:"familyName"}),dataIndex:"familyName",sorter:function(e,r){return Z.ZP.antdTableSorter(e,r,"code")}},{key:"name",title:(0,P.jsx)(k.Z,{id:"name"}),dataIndex:"name",sorter:function(e,r){return Z.ZP.antdTableSorter(e,r,"name")}},{key:"school",title:(0,P.jsx)(k.Z,{id:"main-school"}),dataIndex:["school","name"],sorter:function(e,r){return Z.ZP.antdTableSorter(e,r,"school")}},{key:"subSchool",title:(0,P.jsx)(k.Z,{id:"sub-school"}),dataIndex:["subSchool","name"],sorter:function(e,r){return Z.ZP.antdTableSorter(e,r,"subSchool")}},{key:"joinDate",title:(0,P.jsx)(k.Z,{id:"joinDate"}),dataIndex:"joinDate",sorter:function(e,r){return Z.ZP.antdTableSorter(e,r,"joinDate")}},{key:"phone",title:(0,P.jsx)(k.Z,{id:"phone1"}),dataIndex:"phone",sorter:function(e,r){return Z.ZP.antdTableSorter(e,r,"phone")},render:function(e){return(0,P.jsx)("span",{children:e.substr(0,4)+"-"+e.substr(4,9)})}}];return!0!==e.permissions.edit&&!0!==e.permissions.destroy||U.push({key:"actions",title:(0,P.jsx)(k.Z,{id:"main.action"}),width:"15vw",dataIndex:"actions",render:function(r,s){return(0,P.jsxs)("div",{className:"text-center",children:[e.permissions.password&&(0,P.jsx)(_.Z,{user:s.user.id}),!0===e.permissions.edit&&(0,P.jsxs)(d.Z,{size:"small",onClick:function(){return function(e){z("edit"),S(e),I(!0)}(s)},type:"text",icon:(0,P.jsx)(u.Z,{twoToneColor:"#ffdb00"}),children:[" ",(0,P.jsx)(k.Z,{id:"edit"})]}),!0===e.permissions.destroy&&(0,P.jsxs)(d.Z,{size:"small",onClick:function(){return function(e){E({title:"\u0423\u0441\u0442\u0433\u0430\u0445 \u0443\u0443?",okText:"\u0423\u0441\u0442\u0433\u0430\u0445",okType:"danger",cancelText:"\u0411\u043e\u043b\u0438\u0445",onOk:function(){Q({variables:{id:e.id}})}})}(s)},type:"text",icon:(0,P.jsx)(m.Z,{twoToneColor:"#f42f2f"}),children:[" ",(0,P.jsx)(k.Z,{id:"delete"})]})]})}}),(0,P.jsxs)(P.Fragment,{children:[e.permissions.create||!0===e.permissions.edit?(0,P.jsx)(n.Z,{title:"create"===V?(0,P.jsx)(k.Z,{id:"add_new"}):(0,P.jsx)(k.Z,{id:"edit"}),visible:C,width:"80vw",okText:(0,P.jsx)(k.Z,{id:"main.okText"}),cancelText:(0,P.jsx)(k.Z,{id:"main.cancelText"}),onCancel:function(){I(!1)},okButtonProps:{form:"TeacherForm",key:"submit",htmlType:"submit"},children:(0,P.jsx)(Y,{refetch:J,formType:V,editData:N,setIsModalVisible:I})}):null,(0,P.jsxs)(l.Z,{children:[(0,P.jsxs)(h.Z,{alignItems:"center",justifyContent:"between",mobileFlex:!1,children:[(0,P.jsx)(h.Z,{className:"mb-1",mobileFlex:!1,children:(0,P.jsx)("div",{className:"mr-md-3 mb-3",children:(0,P.jsx)(o.Z,{placeholder:"\u0425\u0430\u0439\u0445",prefix:(0,P.jsx)(x.Z,{}),onChange:function(e){return function(e){var r=e.currentTarget.value;R({variables:{offset:0,limit:9,filter:r,modelName:p,appName:v}})}(e)}})})}),!0===e.permissions.create?(0,P.jsx)("div",{className:"mr-md-3 mb-3",children:(0,P.jsxs)(d.Z,{onClick:function(){z("create"),I(!0)},type:"primary",icon:(0,P.jsx)(j.Z,{}),block:!0,children:[" ",(0,P.jsx)(k.Z,{id:"add_new"})]})}):null]}),(0,P.jsx)("div",{className:"table-responsive",children:(0,P.jsx)(c.Z,{size:"small",columns:U,dataSource:f,rowKey:"id",bordered:!0,loading:H,pagination:!0})})]})]})},B=s(59288),V=s(38937),z=function(e){var r={create:(0,B.C)("add_teacher"),edit:(0,B.C)("change_teacher"),destroy:(0,B.C)("delete_teacher"),permission:(0,B.C)("change_permission"),password:(0,B.C)("change_user_password")};return Object.values(r).indexOf("loading")>-1?(0,P.jsx)(V.Z,{cover:"content"}):(0,P.jsx)(O,{title:e.title,permissions:r})}}}]);
//# sourceMappingURL=6487.b1074005.chunk.js.map